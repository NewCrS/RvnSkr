<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Revenantskr - The Independent Security Mandate (ISM)</title>
	<style>
		body {
			margin: 0;
			font-family: Arial, Sans-serif, monospace;
			background: #050505;
			color: #e0e0e0;
			overflow-x: hidden;
		}
		
		.interface-wrapper {
			position: relative;
			width: 100%;
			background: radial-gradient(circle at center, #111 0%, #000 100%);
            height: 140px; 
            transition: height 0.6s cubic-bezier(0.22, 1, 0.36, 1);
		}

        body.mode-home .interface-wrapper,
        body.mode-general .interface-wrapper {
            height: 60px; 
        }
		
		header {
		    height: 80px;
		    display: flex;
		    align-items: center;
		    justify-content: center;
		    background: rgba(5, 5, 5, 0.7); 
		    border-bottom: 1px solid transparent; 
		    position: relative;
		    z-index: 2;
		    backdrop-filter: blur(5px); 
		    transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1),
		        filter 0.6s ease,
		        opacity 0.6s ease;
		}

		
		.logo {
			font-size: 36px;
			font-weight: 900;
			letter-spacing: 4px;
			color: #00BBFF;
			text-shadow: 0 0 15px rgba(0, 187, 255, 0.6);
			user-select: none;
			transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
			transform: scale(1.2);
		}
		
		nav {
			height: 60px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 50px; 
			background: transparent; 
			position: relative; 
			z-index: 10;
			border-bottom: 1px solid #222;
			
			transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1),
				filter 0.6s ease;
		}
		
		.tab-slider {
			position: absolute;
			height: 100%; 
			top: 0;
			left: 0;
			z-index: 1; 
			pointer-events: none; 
			
			border-left: 2px solid #00BBFF;
			border-right: 2px solid #00BBFF;
			background: transparent; 

			transition: width 0.3s cubic-bezier(0.22, 1, 0.36, 1), 
						transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
		}

		nav a {
			position: relative; 
            z-index: 2;
			text-decoration: none;
			color: #888;
			font-size: 14px;
			font-weight: bold;
			cursor: pointer;
			text-transform: uppercase;
			letter-spacing: 2px;
			transition: 0.3s;
			padding: 10px 20px; 
			border: 1px solid transparent;
		}
		
		nav a:hover,
		nav a.active-link {
			color: #fff;
			text-shadow: 0 0 5px rgba(0, 187, 255, 0.5);
			border: none !important;
			background: transparent !important;
			box-shadow: none !important;
		}
		
		.content-area {
			padding-top: 140px; 
			padding-bottom: 60px;
			padding-left: 20px;
			padding-right: 20px;
			text-align: center;
			min-height: 400px;
            transition: padding-top 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative; 
            z-index: 5; 
		}

        body.mode-home .content-area,
        body.mode-general .content-area {
            padding-top: 60px;
        }
		
		.tab-content {
			display: none;
			opacity: 0;
			transform: translateY(40px);
			animation: fadeInContent 0.8s forwards;
		}
		
		.tab-content.active {
			display: block;
		}
		
		@keyframes fadeInContent {
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		
		body.mode-home header {
			transform: translateY(60px); 
			border-bottom: none;
			z-index: 1;
		}
		
		body.mode-home nav {
			transform: translateY(-80px); 
			border-bottom: 1px solid #00BBFF;
		}
		
		body.mode-internal header {
			transform: translateY(0);
			z-index: 100;
			box-shadow: 0 5px 20px rgba(0, 0, 0, 0.8);
		}
		
		body.mode-internal nav {
			transform: translateY(0);
			z-index: 90;
		}
		
		body.mode-general header {
			transform: translateY(140px);
			border-bottom: none;
			z-index: 1;
		}
		
		body.mode-general header .logo {
			transform: scale(0.5);
		}
		
		body.mode-general nav {
			transform: translateY(-80px);
			border-bottom: 1px solid #222;
		}
		
		
    .glowing-screen {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        height: 180px;
        background: #00bbff;
        border: 4px solid #00bbff;
        box-shadow: 0 0 50px 10px rgba(0, 187, 255, 0.8),
                    0 0 100px 30px rgba(0, 187, 255, 0.5);
        z-index: 1;
        border-radius: 5px;
        display: flex;
        padding: 10px;
        
        box-sizing: border-box;
        overflow: hidden; 
    }

		
		
		.phasing-through header,
		.phasing-through nav {
			filter: blur(6px);
			opacity: 0.7;
			pointer-events: none;
		}
		
		input {
			background: #111;
			border: 1px solid #333;
			color: #00BBFF;
			padding: 10px;
			font-family: inherit;
			margin-top: 15px;
		}
		
		button {
			background: #00BBFF;
			color: #000;
			border: none;
			padding: 10px 20px;
			font-weight: bold;
			cursor: pointer;
		}

		
		@media screen and (max-width: 600px) {
			
			header {
				height: 60px;
			}
            
            .interface-wrapper {
                height: 110px;
            }

            body.mode-home .interface-wrapper,
            body.mode-general .interface-wrapper {
                height: 50px; 
            }
			
			.logo {
				font-size: 24px;
				letter-spacing: 2px;
			}

			nav {
				height: 50px;
				gap: 20px; 
				padding: 0 5px;
				overflow-x: auto; 
				justify-content: flex-start; 
			}
			
			nav a {
				font-size: 12px;
				padding: 8px 10px; 
				letter-spacing: 1px;
				white-space: nowrap; 
			}
			
			.content-area {
				padding-top: 110px;
				padding-bottom: 30px;
				padding-left: 10px;
				padding-right: 10px;
			}
            
            body.mode-home .content-area,
            body.mode-general .content-area {
                padding-top: 50px;
            }
			
			input, button {
				width: 100%; 
				box-sizing: border-box; 
				margin-top: 10px;
			}

			button {
				margin-left: 0; 
			}
			
			body.mode-home header {
				transform: translateY(50px); 
			}
			
			body.mode-home nav {
				transform: translateY(-60px); 
			}
			
			body.mode-general header {
				transform: translateY(110px); 
			}
			
			body.mode-general nav {
				transform: translateY(-60px); 
			}
		}
		
		/* ====== DUAL FRAME LAYOUT ====== */
		.dual-frame {
		    width: 100%;
		    display: flex;
		    justify-content: space-between;
		    gap: 5%; /* 10% khoảng cách giữa 2 frame */
		    margin-top: 40px;
		}
		
		.frame-box {
		    width: 40%;   /* mỗi frame 40% */
		    height: 300px;
		    border: 1px solid #00BBFF;
		    background: #000;
		}
		
		/* ====== MÀN HÌNH DỌC: 2 FRAME XẾP TRÊN – DƯỚI ====== */
		@media (orientation: portrait) {
		    .dual-frame {
		        flex-direction: column;
		        gap: 10%; /* vẫn giữ 10% cách nhau theo chiều dọc */
		        align-items: center;
		    }
		
		    .frame-box {
		        width: 90%; /* tổng 40 + 40 + 10 = 90, nên set 90% cho hợp lý */
		        height: 220px;
		    }
		}
		/* FRAME SYSTEM */
		.frame-wrapper {
		    display: flex;
		    width: 100%;
		    height: auto;
		    margin: 0;
		    padding: 0;
		    justify-content: center;
		    align-items: center;
		    gap: 10%;
		}
		
		.frame-box {
		    width:40%;
		    height: 300px;
		    background: #0a0a0a;
		    border: 1px solid #00bbff55;
		    backdrop-filter: blur(6px);
		    box-shadow: 0 0 20px #00bbff22;
		    animation-duration: 0.8s;
		    animation-fill-mode: both;
		    border-radius: 10px;
		}
		
		/* Hiệu ứng trượt từ trái */
		.slide-left {
		    animation-name: slideFromLeft;
		}
		
		/* Hiệu ứng trượt từ phải */
		.slide-right {
		    animation-name: slideFromRight;
		}
		
		@keyframes slideFromLeft {
		    from { transform: translateX(-80px); opacity: 0; }
		    to   { transform: translateX(0); opacity: 1; }
		}
		
		@keyframes slideFromRight {
		    from { transform: translateX(80px); opacity: 0; }
		    to   { transform: translateX(0); opacity: 1; }
		}
		
		/* Nếu màn hình dọc → 2 frame xếp dọc */
		@media (orientation: portrait) {
		    .frame-wrapper {
		        flex-direction: column;
		        gap: 10%;
		    }
		    .frame-box {
		        width: 80%;
		        height: 250px;
		    }
		}

        /* --- CSS CHO BẢNG BÍ MẬT (SECRET MODAL) --- */
        .secret-modal-overlay {
            /* Che phủ toàn màn hình */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Nền mờ */
            backdrop-filter: blur(4px);
            z-index: 9999; /* Đảm bảo nó luôn nằm trên cùng */
            display: none; /* Mặc định ẩn */
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* --- CSS CHO BẢNG BÍ MẬT (SECRET MODAL) --- */
        .secret-modal-overlay {
            /* Che phủ toàn màn hình */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Nền mờ */
            backdrop-filter: blur(4px);
            z-index: 9999; /* Đảm bảo nó luôn nằm trên cùng */
            display: none; /* Mặc định ẩn */
            opacity: 0;
            transition: opacity 0.3s ease;
        }

				.secret-modal-content {
				    position: absolute;
				    top: 50%;
				    left: 50%;
				    transform: translate(-50%, -50%);
				    padding: 30px;
				    background: #0d0d0d;
				    border: 3px solid #00BBFF;
				    box-shadow: 0 0 40px #00BBFFAA;
				    border-radius: 5px;
				    /* Giá trị mặc định (Web/Desktop) */
				    width: 800px; 
				    max-width: 95%; 
				    max-height: 95%;
				    overflow: auto;
				    text-align: center;
				    transition: all 0.3s ease;
				}
				
				/* Media Query cho giao diện điện thoại (Màn hình rộng tối đa 600px) */
				@media screen and (max-width: 600px) {
				    .secret-modal-content {
				        width: 400px; /* Chiều rộng cố định cho điện thoại */
				        max-width: 96%; /* Vẫn giữ co giãn cho màn hình cực nhỏ */
				        padding: 20px; /* Giảm padding cho điện thoại */
				    }
				}

        .secret-modal-content img {
            /* Định dạng ảnh bên trong */
            max-width: 100%;
            max-height: 80vh; /* Giới hạn chiều cao cho cả hai */
            display: block;
            margin: 0 auto 15px;
            border: 1px solid #333;
        }

        .secret-modal-content h3 {
            color: #FF00FF;
            margin-top: 0;
        }

        .secret-modal-content p {
            color: #fff;
            font-size: 14px;
        }

        .secret-modal-overlay.active {
            display: block;
            opacity: 1;
        }

        .close-btn {
            background: #00BBFF;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.2s;
        }
        .close-btn:hover {
            background: #0088CC;
        }
        
				/* CSS MỚI: Modal khởi động */
				.startup-overlay {
				    position: fixed;
				    top: 0;
				    left: 0;
				    width: 100%;
				    height: 100%;
				    background: #000; /* Nền đen */
				    color: #00BBFF;
				    z-index: 10000; /* Đảm bảo nằm trên cùng */
				    display: flex;
				    flex-direction: column;
				    justify-content: center;
				    align-items: center;
				    text-align: center;
				    opacity: 1;
				    transition: opacity 0.5s ease, visibility 0.5s ease;
				}
				
				.startup-overlay.hidden {
				    opacity: 0;
				    visibility: hidden;
				    pointer-events: none;
				}
				
				.startup-overlay h1 {
				    font-size: 2em;
				    margin-bottom: 20px;
				    text-shadow: 0 0 10px rgba(0, 187, 255, 0.7);
				}
				
				.startup-overlay button {
				    /* Tái sử dụng style nút cũ của bạn */
				    background: #00BBFF;
				    color: #000;
				    border: none;
				    padding: 12px 25px;
				    font-weight: bold;
				    cursor: pointer;
				    font-size: 1.1em;
				    box-shadow: 0 0 15px rgba(0, 187, 255, 0.5);
				    transition: background 0.2s;
				}


			/* --- HIỆU ỨNG HẠT BỤI MỜ (DUST PARTICLE EFFECT) - PHIÊN BẢN JS --- */
			.dust-overlay {
			    position: fixed;
			    top: 0;
			    left: 0;
			    width: 100%;
			    height: 100%;
			    z-index: 800000; 
			    pointer-events: none; 
			    overflow: hidden; 
			}
			
/* --- LỚP PHỦ BỤI NỀN (BACKGROUND DUST) --- */
			.dust-overlay-background {
			    position: fixed;
			    top: 0;
			    left: 0;
			    width: 100%;
			    height: 100%;
			    /* Z-index thấp nhất, nằm dưới Header (z-index: 2) và Nav (z-index: 10) */
			    z-index: 1; 
			    pointer-events: none; 
			    overflow: hidden; 
			}

			
			
			/* Lớp CSS cho từng hạt bụi (sẽ được tạo bằng JS) */
			.dust-particle {
			    position: absolute;
			    width: 8px; /* Kích thước hạt */
			    height: 8px;
			    background: #fff; /* Màu trắng mờ */
			    border-radius: 50%;
			    opacity: 0; /* Mặc định ẩn, sẽ hiện khi JS chèn vào */
			    filter: blur(4px); /* Làm mờ nhẹ */
			    animation: floating-dust 180s linear infinite;
			    
			}
			
			@keyframes floating-dust {
			    0% {
			        /* Trạng thái bắt đầu: Bay nhẹ nhàng, thay đổi vị trí nhẹ */
			        transform: translate3d(0, 0, 0) rotate(0deg);
			        opacity: 0.2;
			    }
			    
			    25% {
			        /* Lớp bụi trôi lên và sang trái */
			        transform: translate3d(-40px, -20px, 0) rotate(5deg);
			        opacity: 0.4;
			    }
			    
			    50% {
			        /* Lớp bụi trôi xuống và sang phải */
			        transform: translate3d(40px, 20px, 0) rotate(-5deg);
			        opacity: 0.1;
			    }
			    
			    75% {
			        /* Lớp bụi trôi lên và sang phải nhẹ */
			        transform: translate3d(20px, -80px, 0) rotate(8deg);
			        opacity: 0.3;
			    }
			    
			    100% {
			        /* Quay về vị trí ban đầu (0%) */
			        transform: translate3d(0, 0, 0) rotate(0deg);
			        opacity: 0.2;
			    }
			}


			/* --- Lớp Hạt Bụi Nằm Ở Phía Trước/Trên (Foreground Layer) --- */
/* --- Lớp Hạt Bụi Nằm Ở Phía Trước/Trên (Foreground Layer) --- */
			.dust-particle-foreground {
			    position: absolute;
			    width: 6.4px; 
			    height: 6.4px;
			    background: #fff; 
			    border-radius: 50%;
			    opacity: 0; 
			    filter: blur(2px); 
			    animation: floating-dust-fast 80s linear infinite; 
			    
			}

			
			/* Keyframes mới cho lớp trước: Biến đổi nhanh hơn Zero-G */
			@keyframes floating-dust-fast {
			    0% {
			        transform: translate3d(0, 0, 0) rotate(0deg);
			        opacity: 0.1;
			    }
			    
			    25% {
			        transform: translate3d(-18px, -8px, 0) rotate(8deg);
			        opacity: 0.25;
			    }
			    
			    50% {
			        transform: translate3d(20px, 8px, 0) rotate(-10deg);
			        opacity: 0.05;
			    }
			    
			    75% {
			        transform: translate3d(8px, -40px, 0) rotate(4deg);
			        opacity: 0.2;
			    }
			    
			    100% {
			        transform: translate3d(0, 0, 0) rotate(0deg);
			        opacity: 0.1;
			    }
			}
			

.glow-frame {
    background: #00aadd00;
    border: 0px solid #00aadd;
    border-radius: 0px;

    box-shadow: none; /*
        0 0 30px 10px #00aadd,   
        0 0 70px 18px #00aadd,  
        0 0 100px 40px #00aadd;  */
}


/* THÊM CSS MỚI: Style cho Iframe Camera trên màn hình General */
#general .frame-wrapper {
    /* Đảm bảo khung bao bọc iframe là trung tâm */
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    margin-top: 20px;
}

#general iframe {
    /* Style đặc trưng cho màn hình quét (màu phụ nổi bật: Magenta #FF00FF) */
    width: 90%; 
    max-width: 640px;
    min-height: 480px; /* Đặt chiều cao tối thiểu cho nội dung camera */
    height: auto;
    border: 3px solid #FF00FF; 
    box-shadow: 0 0 25px rgba(255, 0, 255, 0.7); /* Ánh sáng Magenta */
    background: #000;
}

.error-shake {
    animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
    perspective: 1000px;
}

@keyframes shake {
    10%, 90% {
        transform: translate3d(-1px, 0, 0);
    }
    20%, 80% {
        transform: translate3d(2px, 0, 0);
    }
    30%, 50%, 70% {
        transform: translate3d(-4px, 0, 0);
    }
    40%, 60% {
        transform: translate3d(4px, 0, 0);
    }
}

        
        
	</style>
</head>

<body class="mode-home">
  <audio id="background-music" src="assets/theme.mp3" loop></audio>


  <div class="startup-overlay" id="startupOverlay">
      <h1>REVENANTSKR INTERFACE</h1>
      <p>Lần đầu đến Revenantskr nhỉ? bạn vẫn chưa có mặt trong cơ sở dữ liệu đâu.</p>
      <button id="startButton">ẤN ĐỂ BẮT ĐẦU!</button>
  </div>
    
  <div class="dust-overlay-background"></div> 

  <div class="interface-wrapper"> 

 		<header id="mainHeader">
			<div class="logo">REVENANTSKR</div>
		</header>
		
		<nav id="mainNav">
			<div class="tab-slider"></div> 
			<a onclick="switchTab('home')" id="btn-home" class="active-link">HOME</a>
			<a onclick="switchTab('general')" id="btn-general">GENERAL</a>
			<a onclick="switchTab('about')" id="btn-about">ABOUT</a>
			<a onclick="switchTab('id')" id="btn-id">ID ACCESS</a>
		</nav>
	</div>
	
	<div class="content-area">
		<div id="home" class="tab-content active">
			<div class="dual-frame">
				<iframe src="frame1home.html" class="frame-box slide-right glow-frame"></iframe>
				<iframe src="frame2home.html" class="frame-box slide-left"></iframe>    
			</div>
		</div>
				
		<div id="general" class="tab-content">
		   
		    <div class="frame-wrapper">
		        <div id="camera-frame-container" 
		            style="
		                width: 90%; 
		                max-width: 640px; 
		                min-height: 480px; 
		                border: 3px solid #FF00FF; 
		                box-shadow: 0 0 25px rgba(255, 0, 255, 0.7); 
		                background: #000;
		                display: flex;
		                justify-content: center;
		                align-items: center;
		                font-size: 1.2em;
		                color: #888;
		                padding: 20px;
		            ">
		            <p>Scanning Module is offline. Click 'GENERAL' to initialize and request camera access.</p>
		        </div>
		    </div>
		</div> 
		<div id="about" class="tab-content">
			<h2 style="color: #00BBFF">ABOUT SYSTEM</h2>
			<p>Quyền truy cập bị từ chối!</p>
			<p>Đề nghị xác minh hoặc nhận ủy quyền cao hơn.</p>
		</div>
		
		<div id="id" class="tab-content">
		    <h2>SECURITY CHECK</h2>
		    <p>Nhập mã định danh để truy cập >Core<</p>
		    <div style="margin-top: 15px;">
		        <input type="text" id="idInput" placeholder="ENTER YOUR ID" onkeydown="if(event.key === 'Enter') checkID()" />
		        <button onclick="checkID()">VERIFY</button>
		    </div>
		    <p id="idError" style="color: #FFFFFF; margin-top: 10px; font-weight: bold; display: none;">
		        </p>
		</div>

		
		<script>
			let currentMode = 'home';
			
			function updateSliderPosition(activeButtonId) {
				const slider = document.querySelector('.tab-slider');
				const activeButton = document.getElementById(activeButtonId);
				const nav = document.getElementById('mainNav');

				if (!activeButton || !slider || !nav) return;

				const navRect = nav.getBoundingClientRect();
				const buttonRect = activeButton.getBoundingClientRect();

				slider.style.width = `${buttonRect.width}px`;
				
				const translateX = buttonRect.left - navRect.left; 
				
				slider.style.transform = `translateX(${translateX}px)`;
			}
			
			
			function switchTab(tabName) {
			    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active-link'));
			    const targetButtonId = `btn-${tabName}`;
			    document.getElementById(targetButtonId).classList.add('active-link');
			    
			    updateSliderPosition(targetButtonId); 
			    
			    const targetMode = (tabName === 'home') ? 'home' : (tabName === 'general' ? 'general' : 'internal');
			    
			    // LOGIC ĐÃ SỬA: Bật/Tắt camera
			    if (tabName === 'general') {
			        loadGeneralScanner();
			    } else {
			        unloadGeneralScanner(); // Tắt camera khi chuyển tab
			    }
			    
			    let blurRequired = false;
			    
			    // ... (Phần logic chuyển đổi mode giữ nguyên) ...
			    if (currentMode === 'internal' || targetMode === 'internal') {
			        blurRequired = true;
			    }
			    
			    if (currentMode === 'home' && targetMode === 'general') {
			        blurRequired = false;
			    }
			    if (currentMode === 'general' && targetMode === 'home') {
			        blurRequired = false;
			    }
			    
			    if (currentMode !== targetMode) {
			        triggerPhaseShift(targetMode, blurRequired);
			    }
			    
			    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
			    document.getElementById(tabName).classList.add('active');
			}
			
			/**
			 * Hàm chỉ chèn iframe camera khi vào tab General
			 */
			let generalScannerLoaded = false; 
			
			function loadGeneralScanner() {
			    if (generalScannerLoaded) {
			        return; // Đã tải, không làm gì nữa
			    }
			    
			    const container = document.getElementById('camera-frame-container');
			    if (container) {
			        // Tạo Iframe và cấu hình các thuộc tính cần thiết
			        const iframe = document.createElement('iframe');
			        iframe.src = "scan.html";
			        iframe.frameBorder = "0";
			        iframe.allow = "camera; microphone"; // Yêu cầu quyền truy cập camera
			        
			        // Áp dụng style cho iframe
			        iframe.style.width = "100%";
			        iframe.style.height = "100%";
			        iframe.style.background = "#000";
			        iframe.style.border = "none";
			        
			        // Thay thế nội dung placeholder bằng iframe
			        container.innerHTML = ''; 
			        container.appendChild(iframe);
			        
			        generalScannerLoaded = true;
			        console.log("Scanning Module Initialized. Camera permission requested via iframe.");
			    }
			}
				
			/**
			 * Hàm tắt và xóa iframe camera khi rời khỏi tab General
			 */
			function unloadGeneralScanner() {
			    if (!generalScannerLoaded) {
			        return; // Đã tắt rồi
			    }
			    
			    const container = document.getElementById('camera-frame-container');
			    if (container) {
			        // Xóa nội dung iframe
			        container.innerHTML = ''; 
			        
			        // Tạo lại nội dung Placeholder ban đầu
			        const placeholder = document.createElement('p');
			        placeholder.textContent = "Scanning Module is offline. Click 'GENERAL' to initialize and request camera access.";
			        
			        // Đảm bảo container có các thuộc tính display/justify/align để text được căn giữa
					container.style.display = 'flex';
					container.style.justifyContent = 'center';
					container.style.alignItems = 'center';
			        
			        container.appendChild(placeholder);
			        
			        generalScannerLoaded = false;
			        console.log("Scanning Module Offline. Iframe removed.");
			    }
			}
		
			// --- HÀM XỬ LÝ MODAL ---
			function showSecretModal(title, message, imageUrl) {
			    const modal = document.getElementById('secretModal');
			    const modalTitle = document.getElementById('modalTitle');
			    const modalMessage = document.getElementById('modalMessage');
			    const modalImage = document.getElementById('modalImage');
			
			    modalTitle.textContent = title;
			    modalMessage.innerHTML = message;
			
			    if (imageUrl) {
			        modalImage.src = imageUrl;
			        modalImage.style.display = 'block';
			    } else {
			        modalImage.style.display = 'none';
			        modalImage.src = '';
			    }
			
			    modal.classList.add('active');
			}
			
			function closeSecretModal() {
			    document.getElementById('secretModal').classList.remove('active');
			    startBackgroundMusic();
			}
			// --- KẾT THÚC HÀM XỬ LÝ MODAL ---


// TRONG FILE index.html (Nằm trong thẻ <script>)

function checkID() {
    const idInput = document.getElementById("idInput");
    const idError = document.getElementById("idError");
    const id = idInput.value.trim();

    // 1. Reset trạng thái lỗi
    idError.style.display = 'none';
    idError.textContent = '';
    idInput.classList.remove('error-shake');
    
    // 2. Kiểm tra nếu chưa nhập gì
    if (!id) {	
        idError.textContent = "⚠️ LỖI: Mã định danh không được để trống.";
        idError.style.display = 'block';
        idInput.classList.add('error-shake'); 
        idInput.focus();
        return; 
    }
    
    // ĐÍCH CUỐI CÙNG LÀ TRANG HIỆN TẠI (index.html) để hiển thị Modal
    const finalTarget = "./"; 
    
    // Gán popupType dựa trên ID nhập vào (dùng để forward.html kiểm tra)
    const popupType = `POPUP_${id}`; 
    
    // Lưu loại popup vào sessionStorage
    sessionStorage.setItem('tempPopupType', popupType);
    
    // Xây dựng URL chuyển hướng đến trang trung gian
    const forwardURL = `forward.html?id=${encodeURIComponent(id)}&target=${encodeURIComponent(finalTarget)}`;
    
    // Tiến hành chuyển hướng
    window.location.href = forwardURL;
}


		function triggerPhaseShift(targetMode, blurRequired) {
		    const body = document.body;
		    
		    // 1. Reset các class mode cũ
		    body.classList.remove('mode-home', 'mode-general', 'mode-internal', 'phasing-through');
		    
		    // 2. Thiết lập class mode mới
		    body.classList.add(`mode-${targetMode}`);
		    
		    // 3. Xử lý hiệu ứng làm mờ chuyển đổi (nếu có)
		    if (blurRequired) {
		        body.classList.add('phasing-through');
		        // Xóa hiệu ứng blur sau khi chuyển đổi xong (600ms tương ứng với thời gian transition CSS)
		        setTimeout(() => {
		            body.classList.remove('phasing-through');
		        }, 180); 
		    }
		    
		    // Cập nhật currentMode
		    currentMode = targetMode; 
		    
		    // Kích hoạt lại hiệu ứng trượt cho Frame Home nếu quay lại Home
		    if (targetMode === 'home') {
		        applyFrameSlideEffect(); 
		    }
		}

			function applyFrameSlideEffect() {
			    const frames = document.querySelectorAll('#home .frame-box');
			
			    if (frames.length === 2) {
			        frames[0].classList.remove("slide-left", "slide-right");
			        frames[1].classList.remove("slide-left", "slide-right");
			
			        // Ép kích hoạt lại animation
			        void frames[0].offsetWidth;
			        void frames[1].offsetWidth;
			
			        frames[0].classList.add("slide-left");
			        frames[1].classList.add("slide-right");
			    }
			}			
			
			
			
window.onload = function() {
    const startupOverlay = document.getElementById('startupOverlay');
    const startButton = document.getElementById('startButton');
    const isForwarded = sessionStorage.getItem('isForwarded');
    const requestedPopup = sessionStorage.getItem('secretPopupKey');
    const params = new URLSearchParams(window.location.search);
    
    // Tham số tùy chỉnh mới
    const customIntro = params.get('INTRODUCTION');
    const customIdent = params.get('IDENTIFICATION');
    const customInfo = params.get('INFORMATION');
    
    // Dữ liệu dùng cho thông báo lỗi/trạng thái chung (nếu cần)
    const passedID = params.get('id') || 'N/A';

    if (isForwarded === 'true' && requestedPopup) {
        
        if (startupOverlay) {
             startupOverlay.classList.add('hidden');
        }
        
        // --- ĐỊNH NGHĨA 3 ELEMENTS HOÀN TOÀN DỰA TRÊN URL ---
        let modalTitle = "SYSTEM MESSAGE";
        let modalDetail = "⚠️ LỖI: Nội dung chi tiết (INFORMATION) không được gửi kèm trong chuyển tiếp."; 
        let modalImageURL = "";
        
        // 1. Kiểm tra xem có đủ dữ liệu cơ bản để hiển thị Modal không
        if (customIntro && customInfo) {
            // Nếu có đủ INTRODUCTION và INFORMATION, gán trực tiếp
            modalTitle = decodeURIComponent(customIntro);
            modalDetail = decodeURIComponent(customInfo);
            
            // 2. Gán Image URL (IDENTIFICATION) nếu tồn tại
            if (customIdent) {
                modalImageURL = decodeURIComponent(customIdent);
            }
        } else {
            // Trường hợp không có dữ liệu tùy chỉnh (Chế độ dự phòng lỗi)
            modalTitle = "TRANSFER ERROR - NO DATA";
            modalDetail = `⚠️ **LỖI CHUYỂN TIẾP:** Thiếu các tham số INTRODUCTION hoặc INFORMATION. Kiểm tra lại cấu hình file trung gian. ID: ${passedID}`;
            modalImageURL = "";
        }
        
        // Gọi hàm showSecretModal
        showSecretModal(modalTitle, modalDetail, modalImageURL);

        sessionStorage.removeItem('isForwarded');
        sessionStorage.removeItem('secretPopupKey');
        const newURL = window.location.pathname; 
        history.replaceState(null, '', newURL); 
        
    } else {
        if (startButton) {
            startButton.addEventListener('click', function() {
                startBackgroundMusic(); 
                startupOverlay.classList.add('hidden');
            });
        }
    }
    
    const activeBtn = document.querySelector('nav a.active-link');
    if (activeBtn) {
        updateSliderPosition(activeBtn.id);
    } else {
        updateSliderPosition('btn-home');
    }
};

			// Thêm hoặc đảm bảo hàm này tồn tại
			function startBackgroundMusic() {
			    const audio = document.getElementById('background-music');
			    if (!audio) return; 
			    
			    // Đặt âm lượng ở mức vừa phải (ví dụ: 40%)
			    audio.volume = 0.4; 
			    
			    // Lệnh play() này phải nằm trong hàm, được gọi sau khi nút được nhấn
			    audio.play().then(() => {
			        console.log("Nhạc nền đã được kích hoạt.");
			    }).catch(error => {
			        console.error("Lỗi: Không thể phát nhạc nền.", error);
			    });
			}


					// --- BẮT ĐẦU: MÃ JAVASCRIPT TẠO HẠT BỤI TÙY CHỈNH (HỖ TRỢ 2 LAYER) ---
					// Thêm tham số 'parentSelector' để chọn lớp cha
					function generateDustParticles(count, className, parentSelector, durationMin, durationMax, opacityMin, opacityMax) { 
					    const overlay = document.querySelector(parentSelector); // SỬ DỤNG SELECTOR ĐỂ CHỌN LỚP CHA
					    if (!overlay) return; // Thoát nếu không tìm thấy lớp cha
					    
					    const screenWidth = window.innerWidth;
					    const screenHeight = window.innerHeight;
					    
					    for (let i = 0; i < count; i++) {
					        const particle = document.createElement('div');
					        particle.className = className;
					        
					        const startX = Math.random() * screenWidth;
					        const startY = Math.random() * screenHeight;
					        
					        particle.style.left = `${startX}px`;
					        particle.style.top = `${startY}px`;
					        
					        const delay = Math.random() * 60; 
					        particle.style.animationDelay = `-${delay}s`;
					        
					        const duration = durationMin + Math.random() * (durationMax - durationMin);
					        particle.style.animationDuration = `${duration}s`;
					        
					        const initialOpacity = opacityMin + Math.random() * (opacityMax - opacityMin);
					        particle.style.opacity = initialOpacity;
					        
					        overlay.appendChild(particle);
					    }
					}
					// --- KẾT THÚC: MÃ JAVASCRIPT TẠO HẠT BỤI TÙY CHỈNH ---
					// Gọi hàm để tạo cả hai lớp hạt bụi khi trang được tải
					document.addEventListener('DOMContentLoaded', () => {
					    // 1. Lớp Nền (Background Layer) - Z-index thấp
					    generateDustParticles(
					        18, 
					        'dust-particle', 
					        '.dust-overlay-background', // CHÈN VÀO LỚP NỀN (Z-INDEX: 1)
					        18, 
					        180, 
					        0.1, 
					        0.5
					    );
					    
					    // 2. Lớp Phủ Ngoài (Foreground Layer) - Z-index cao
					    generateDustParticles(
					        8, 
					        'dust-particle-foreground', 
					        '.dust-overlay', // CHÈN VÀO LỚP PHỦ NGOÀI (Z-INDEX: 800000)
					        8, 
					        18, 
					        0.05, 
					        0.3
					    );
					});


			
		</script>
		
    </div>
    
    <div class="secret-modal-overlay" id="secretModal">
        <div class="secret-modal-content">
            <h3 id="modalTitle">SECRET ACCESS GRANTED</h3>
            <img id="modalImage" src="" alt="Secret Image" style="display: none;"> 
            <p id="modalMessage"></p> 
            <button class="close-btn" onclick="closeSecretModal()">CLOSE [SYSTEM ONLINE]</button>
        </div>
    </div>
    
    
    	<div class="dust-overlay"></div>
    </body>

</html>
